%!TEX root = ../Thesis_example_compile_this.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Latent Factor Imputation}
\label{ch:impute}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This chapter presents a novel algorithm for imputing latent factors called \gls{SGRI}. Imputation of latent factors implies a problem where all values are missing or unknown. Conditioning gridded realizations of latent factors requires assigning valid latent values at the data locations. The goal is to impute latent factors with a unique covariance structure that, when combined with inferred \gls{NMR} mapping, return the true observed values at the data locations within a tolerance. Traditionally, this problem has been approached through Gibbs sampling, though there are noted challenges in achieving stable convergence with spatially correlated variables. \gls{SGRI} is a simple approach that combines \gls{SGS}, rejection sampling and exact data matching. Conditional moments are calculated with \gls{SGS}, ensuring the spatial relationships are correct and iterative rejection sampling ensures the collocated multivariate relationships are correct. Realizations of latent factors are generated and become conditioning data for gridded realizations. When mapped to observed space, the realizations reproduce non-Gaussian spatial features specified by the \gls{NMR} as well as uni- and multivariate statistics. A small synthetic example demonstrates imputing latent factors, conditional simulation and mapping the latent space to observed space.

\FloatBarrier
\section{Imputation Concepts}
\label{sec:impute}

Imputation is a method to ``fill in'' missing values \citep{little2019statistical}. Missing values may be uni- or multivariate and multiple mechanisms or patterns of missingness are possible. Multivariate transformations, common in modern geostatistical workflows, such as \gls{PPMT} \citep{barnett2014projection} require homotopic sampling necessitating imputation methods. Ignoring these missing values results in a loss of information or potential bias if the missingness mechanism is not random. The simplest deterministic approach to imputation is taking the global mean or median of sampled values or employing a regression model. This inference permits the use of all data in subsequent modeling however no uncertainty in the imputed values is captured.

Single imputation involves imputing a single value for each missing data value. \cite{little2019statistical} describe single imputation techniques as (1) mean imputation where the global mean value is substituted; (2) regression imputation where missing values are replaced by predicted value from a regression of missing variable on the observed variables; and (3) stochastic regression imputation where missing values are replaced by a predicted value plus a residual. The single imputation paradigm amounts to saying the missing values are known and constant. Though all data may be included in statistical analysis, this assumption results in incorrect uncertainty as the true values are unknown. Furthermore, data sets imputed with mean or regression imputation will not have the correct mean or variance \citep{barnett2015multivariate}. For these reasons multiple imputation techniques are preferred when characterizing imputation uncertainty is important.

Multiple imputation involves generating realizations of missing values such that imputation uncertainty can be assessed. A model of the conditional distribution of the missing values given the observed values is inferred and then stochastically sampled resulting in complete data set realizations. Multiple imputation in a geostatistical context is often a constrained problem where the imputed values must (1) reproduce underlying multivariate relationships and (2) reproduce the spatial variability of observed values \citep{barnett2015multivariate}. Collocated variables characterize the multivariate relationships and the covariance structure of the observed variables characterize the spatial variability. The conditional distribution from which the imputed values are drawn is informed by these components \citep{hadavand2023spatial}.

A \textit{latent variable} is a variable that is not directly observed but is assumed related to, and can be inferred from, measured or observed variables \citep{everitt2010cambridge}. Imputation of latent factors is a unique imputation problem where all variables are missing or unsampled \citep{little2019statistical}. The latent factors are not directly observed; they are a synthetic feature of the inferred mathematical model. An example is the \gls{LMR}, which is composed of multiple latent independent random factors operating at different scales \citep{goovaerts1992factorial}. The latent factors are never measured or directly observed but characterize the observed regionalized random variable $Z(\mathbf{u})$. Simulating geologic latent variables subject to other observations or constraints is key component of truncated-Gaussian categorical simulation techniques. The techniques in this chapter do not directly consider categorical values as constraints, though they enforce reproduction of the true continuous values. Latent variable imputation is most commonly performed with a Gibbs Sampler \citep{emery2014simulating,silva2017multiple,arroyo2020iterative,madani2021enhanced} or alternatively the sequential spectral turning bands method \citep{lauzon2020calibration,lauzon2020sequential,lauzon2023joint}. The Gibbs sampler is a Markov chain Monte Carlo method used to sample a multivariate distribution where direct sampling is complex but sampling marginal distributions is simple. The Gibbs sampler is practical for indirectly sampling high-dimensional distributions using univariate conditional distributions, though convergence of the algorithm is a known issue with correlated variables \citep{silva2018enhanced}. Many data necessitate the use of a restricted kriging search which may cause the simulated Gaussian vector to deviate from the desired covariance matrix \citep{emery2014simulating}.


\FloatBarrier
\section{Gibbs Sampler}
\label{sec:gibbs}

The Gibbs sampler \citep{geman1984stochastic} is an iterative simulation algorithm designed to sample an $M$-dimensional multivariate distribution $f(y_{1}, \dots, y_{M})$ of $M$ random variables $\{Y_{1}, \dots, Y_{M}\}$ \citep{little2019statistical}. It is particularly useful where sampling the joint distribution is difficult, but sampling the marginal conditional distributions $f(y_{m}|y_{1},\dots,y_{m-1},y_{m+1},\dots,y_{M}), \ \ m=1,\dots,M$. The Gibbs sampler is summarized in the following general steps:

\begin{enumerate}[noitemsep]
    \item initialize counter $t=0$
    \item initialize a valid arbitrary vector $y^{(0)}$
    \item for each dimension $m=1,\dots,M$:
          \begin{enumerate}
              \item $t=t+1$
              \item set $y^{(t)}_{j} = y^{(t-1)}_{j} \ \ \forall j \neq m$
              \item draw $y^{(t)}_{m}$ from  $f(y_{m}|y_{1},\dots,y_{m-1},y_{m+1},\dots,y_{M})$
              \item finish if $t=t_{MAX}$
          \end{enumerate}
    \item return $y^{(t)}$
\end{enumerate}

Over a sufficient number of iterations the sampled vector converges on the joint distribution. In a geostatistical context the Gibbs sampler is based on the fact the distribution of a Gaussian vector $Y$ conditioned on other values is Gaussian; the mean and variance of this distribution is calculated by simple kriging \citep{emery2014simulating}. The Gibbs sampler simulates both conditional and unconditional vectors. Conditional Gibbs simulation is commonly used for latent variable assignment in truncated-Gaussian techniques \citep{armstrong2011plurigaussian,silva2017multiple} where latent values must respect both the mapping between categorical and continuous space and match the categorical observations when truncated. Imputation of latent factors in the context of this work does not require satisfying inequality constraints at the data locations but does require satisfying the mapping condition between observed and latent space.

\cite{silva2018enhanced} documents Gibbs sampler convergence issues related to restricting the search neighbourhood for updating the marginal conditional distributions. Considering all $n$ data requires the inversion of a rank $n-1$ covariance matrix which becomes unpractical with increasing $n$. Restricting the search to reduce the size of the covariance results in an approximation of the conditional moments and affects algorithm convergence \citep{emery2014simulating, lauzon2020sequential}. \cite{lantuejoul2012simulation} proposed the propagative Gibbs sampler to avoid the matrix inversion requirement though \cite{silva2018enhanced} shows convergence issues are still present with greater than two latent variables and complex truncation rules. These convergence challenges motivate the development of a new simulation algorithm for imputation of latent geologic variables.


\FloatBarrier
\section{Sequential Gaussian Rejection Imputation}
\label{sec:sgri}


\FloatBarrier
\section{Program: NMRIMP}
\label{sec:nmrimp}


\FloatBarrier
\section{Discussion}
\label{sec:discuss05}